# 5.1 导论

本章：理解网络层控制平面的工作原理
控制平面：路由，确定分组从源到目标的路径

# 5.2 路由选择算法

* 路由:按照某种指标(传输延迟,所经过的站点数目等)找到一条从源节点到目标节点的较好路径
* 路由选择算法(routing algorithm)是网络层软件的一部分
* 图抽象：将路由器和路径抽象为点和边（有不同的标准：例如延迟、拥塞程度）
* 最优化原则：路由选择算法就是为所有路由器找到并使用汇集树
* 路由的原则：正确、简单、健壮，稳定、公平、最优

* 路由选择算法分类：
    * 全局：link state
    * 分布：distance vector
    * 静态：非自适应
    * 动态：自适应

## link state

* 工作过程：
    1. 通过渠道获得整个网络拓扑的信息，使用了OSPF协议
    2. 通过Dijkstra算法找出最短路径
    3. 按照此路由表转发分组
    * 例子：**PPT 5-27 - 28**

* 符号标记:
    * c(i,j): 从节点i 到j链路代价(初始状态下非相邻节点之间的链路代价为∞)
    * D(v): 从源节点到节点V的当前路径代价(节点的代价)
    * p(v): 从源到节点V的路径前序节点
    * N’: 当前已经知道最优路径的的节点集合(永久节点的集合)
* 每一个节点用(D(v),p(v))标记：
    * D(v)从源节点由已知最优路径到达本节点的距离
    * p(v)是最优路径的前序节点
* 节点分为临时节点和永久节点两类
* 时间复杂度：平均O(nlogn)，最差O(n<sup>2</sup>)

## distance vector

* 通过不断地交换距离向量信息，让每个节点逐步收敛到整个网络的最佳路由选择，D<sub>x</sub>(y)估计值最终收敛于实际的最小代价值
* 每个节点都将自己的距离矢量估计值传送给邻居，让对方去算
* Bellman-Ford方程：d<sub>x</sub>(y) = min{c(x,v) + d<sub>v</sub>(y)}

### DV的无穷计算问题

* 无穷计算问题：好消息传的快，坏消息传的慢导致无限成环，距离值不断增加，最终趋向无穷大（速度非常慢）
* 解决方案：
* 水平分裂算法：
    * 路由器在向某个邻居通告路由信息时，不会包括那些通过该邻居到达的路径。
    * 在某些拓扑形式下会失败（存在环路）

## LS和DV的对比

DV消息复杂度高，LS收敛时间快，健壮性强。

# 5.3 因特网中自治系统内部的路由选择

## RIP (Routing Information Protocol)

* 使用Distance vector算法
* 链路代价max = 15 hops，大于15说明不可达
* RIP以应用进程的方式实现：route-d (daemon)，使用UDP报文发送

## OSPF (Open Shortest Path First)

* 使用LS算法
* 在IP数据报上直接传送OSPF报文 (而不是通过UDP和TCP)
* 允许有多个代价相同的路径存在 (在RIP协议中只有一个)
* 层次化的OSPF有2个级别的层次性: 本地, 骨干

# 5.4 ISP之间的路由选择: BGP

## 层次路由

* 在一个规模巨大的网络中，不管是LS还是BV都非常困难
（计算的代价、传输的代价巨大，也不满足管理的需求）
* 层次路由：将互联网分成一个个AS(路由器区域)
* 路由变成了: 2个层次路由，内外部运行不同的网关协议
* 优点：解决了规模问题和管理问题

## 互联网AS间路由：BGP

* BGP (Border Gateway Protocol): 自治区域间路由协议“事实上的”标准
* BGP 提供给每个AS以以下方法
    * eBGP: 从相邻的ASes那里获得子网可达信息，向外部进行通告
    * iBGP：将获得的子网可达信息传遍到AS内部的所有路由器
* 基于距离矢量算法（有改进，不仅仅是距离矢量，还包括到达各个目标网络的详细路径）
* 基于策略的路由：决定是否接受、是否向邻居通告等
* 热土豆路由：选择具备最小内部区域代价的网关作为出口

# 5.5 SDN控制平面

* 逻辑上集中的控制平面，网络管理更加容易
* 流量工程更加容易

# 5.6 ICMP :Internet Control Message Protocol

* ICMP消息由IP数据报承载


