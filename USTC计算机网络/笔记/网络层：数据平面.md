# 4.1 导论

* 本章：网络服务的基本原理，聚焦于其数据平面

## 网络层服务

* 在发送主机和接收主机对之间传送段（segment）
* 在发送端将段封装到数据报中
* 在接收端，将段上交给传输层实体
* 网络层协议存在于主机和路由器
* 路由器检查每一个经过它的IP数据报的头部

## 网络层的关键功能

* 转发
    将分组从路由器的输入接口转发到合适的输出接口
* 路由
    * 使用路由算法来决定分组从发送主机到目标接收主机的路径
    * 路由选择算法
    * 路由选择协议
* 数据平面
    * 本地
    * 决定从路由器输入端口到达的分组如何转发到输出端口
* 控制平面
    * 网络范围
    * 决定数据报如何在路由器之间路由，决定数据报从源到目标主机之间的端到端路径
* 控制平面方法：
    * 传统的路由算法: 在路由器中被实现
    * software-defined networking(SDN): 在远程的服务器中实现

## 网络服务模型

* 对于单个数据报的服务
    * 可靠传送
    * 延迟保证
* 对于数据报流的服务:
    * 保序数据报传送
    * 保证流的最小带宽
    * 分组之间的延迟差

## 连接建立

* 在分组传输之前，在两个主机之间，在通过一些路由器所构成的路径上建立一个网络层连接
* 与传输层连接的区别
    * 网络层: 在2个主机之间，涉及到路径上的一些路由器
    * 传输层: 在2个进程之间，很可能只体现在端系统(例如TCP)

# 4.2 路由器组成

* 结构概括
    * 路由：运行选择算法／协议 (RIP, OSPF, BGP)-生成路由表
    * 转发：从输入到输出链路交换数据报-根据路由表进行分组的转发
    * 任何端口实际上既是输入端口也是输出端口
* 输入端口功能
    **PPT 4-16**
* 当给定目标地址查找转发表时，采用最长地址前缀匹配的目标地址表项
* 当交换机构的速率小于输入端口的汇聚速率时，在输入端口可能要排队
    * 需要一个缓存队列
* 交换结构
    * 将分组从输入缓冲区传输到合适的输出端口
    * ![交换机结构](image-11.png)
* 通过内存交换
    * 转发速率被内存的带宽限制 (数据报通过BUS两遍)
    * 一次只能转发一个分组
* 通过总线交换
    * 交换速度受限于总线带宽
    * 1次处理一个分组
* 通过互联网络(crossbar等)的交换
    * 同时并发转发多个分组，克服总线带宽限制


